<!DOCTYPE html>
<html lang="en-US">
  <head><meta name="viewport" content="width=device-width, initial-scale=1">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>Web Performance with Webpack | Wizard Unicorn Ninja</title><meta name="description" content="These are notes from the 'Web Performance with Webpack' course on Frontend Masters."><link rel="shortcut icon" type="image/ico"href=""><link rel="icon" type="image/png"href="/assets/uswds/img/favicons/favicon.png"><link rel="icon" type="image/png"sizes="192x192"href="/assets/uswds/img/favicons/favicon-192.png"><link rel="apple-touch-icon-precomposed" type=""href="/assets/uswds/img/favicons/favicon-57.png"><link rel="apple-touch-icon-precomposed" type=""sizes="72x72"href="/assets/uswds/img/favicons/favicon-72.png"><link rel="apple-touch-icon-precomposed" type=""sizes="114x114"href="/assets/uswds/img/favicons/favicon-114.png"><link rel="apple-touch-icon-precomposed" type=""sizes="144x144"href="/assets/uswds/img/favicons/favicon-144.png"><link rel="stylesheet"
  href="/assets/css/main.css"
  media="screen"><!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-183755378-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() { dataLayer.push(arguments); }
  gtag('js', new Date());
  gtag('config', 'UA-183755378-1', { 'anonymize_ip': true, 'forceSSL': true });
</script></head>
  <body class=" "><a class="usa-skipnav" href="#main-content">Skip to main content</a>
<header class="usa-header usa-header-extended" role="banner" id="usa-header"><div class="usa-navbar">
      <button class="usa-menu-btn">Menu</button>
      <div class="usa-logo" id="extended-mega-logo">
        <a href="/" title="Home"><img class="usa-logo-img" src="/assets/img/hztl-wm.svg" alt="Wizard Unicorn Ninja"><em class="usa-logo-text">
            Wizard Unicorn Ninja
          </em>
        </a>
      </div>
    </div>

    <nav role="navigation" class="usa-nav">
      <div class="usa-nav-inner">
        <button class="usa-nav-close">
          <img src="/assets/uswds/img/close.svg" alt="close">
        </button><ul class="usa-nav-primary usa-accordion"><li><a class="usa-nav-link" href="/resources/">
                <span>Resources</span>
              </a></li><li><a class="usa-nav-link" href="/frontend-masters/">
                <span>Frontend Masters Workshop Notes</span>
              </a></li><li><button class="usa-accordion-button usa-nav-link" aria-expanded="false" aria-controls="nav-3">
              <span>Sitecore Workshop Notes</span>
            </button><ul id="nav-3" class="usa-nav-submenu" aria-hidden="true"><li>
                  <a href="/sitecore/jss">Sitecore JSS Fundamentals</a>
                </li></ul></li></ul><div class="usa-nav-secondary"><ul class="usa-unstyled-list usa-nav-secondary-links"><li>
                  <a href="">
                    
                  </a>
                </li></ul>
          </div></div>
      </div>
    </nav><div class="main-top">
      <div class="progress-container">
        <div class="progress-bar" id="progress"></div>
      </div>
    </div>
  </header>
  <div class="usa-overlay"></div><main id="main-content"class="usa-grid usa-section usa-content usa-layout-docs">
          <div class="usa-layout-docs-main_content"><h1>Web Performance with Webpack</h1><h2 id="web-performance">Web Performance</h2>

<h3 id="top-performance-issues">Top Performance Issues</h3>

<p>What are the top three causes of web performance issues?</p>

<ul>
  <li>Amount of JavaScript for initial download</li>
  <li>Amount of CSS for initial download</li>
  <li>Amount of Network Requests on initial download</li>
</ul>

<h3 id="performance-goals">Performance Goals</h3>

<ul>
  <li>&lt;= 200KB (uncompressed) initial JavaScript [total]</li>
  <li>&lt;= 100KB (uncompressed) initial CSS [total]</li>
  <li>HTTP: &lt;= 6 initial network calls</li>
  <li>HTTP/2 &lt;= 20 initial network calls</li>
  <li>90% code coverage (only 10% code unused)</li>
</ul>

<p>The above performance goals will ensure that you have a fast loading website / application across all user experiences, even in emerging markets.</p>

<h3 id="code-coverage">Code Coverage</h3>

<p>How can you determine your code coverage? Google’s Chrome browser has a feature in its Dev Tools that lets you look at code coverage. With Dev Tools open, press <code class="language-plaintext highlighter-rouge">Shift+⌘+P</code> and type <code class="language-plaintext highlighter-rouge">coverage</code>, then select the first option and click the reload icon. You will then see all of the files and what their code coverage is. This approach to looking at code coverage is a little time consuming, but is currently the only way to check code coverage. It is important to establish performance as a first class citizen, to make performance a priority amongst your team(s). At the bottom of the code coverage view, you can see the total code coverage for all of your files.</p>

<h3 id="code-splitting">Code Splitting</h3>

<p>Google Web Toolkit first introduced the concept of code splitting. They allowed asynchronous code to be loaded dynamically, so (for example) if you had a piece of code that was only needed when a button was clicked, that code could then be imported and run. Code splitting is the process of splitting pieces of your code into async chunks [at build time]. Code splitting [according to Webpack] is arguably one of the most important considerations to undertake when enabling performance in web applications.</p>

<p>How does it work? Webpack, under the hood, takes your entry point and passes it to a resolver where you must make sure the file exists [if it doesn’t exist, you cannot parse and read it]. Webpack then reads the source code, looks for dependency statements like imports, requires, Common JS, AMD syntax, etc… And then Webpack puts object models called dependencies on them. This information is then leveraged to separate everything in the graph into a separate bundle, flatten it, and create it.</p>

<h2 id="code-splitting-1">Code Splitting</h2>

<h3 id="types-of-code-splitting">Types of Code Splitting</h3>

<p>The future of web is mobile, the average mobile website takes 14 seconds to get interactive, loading less code =&gt; interactive faster.</p>

<p>In the context of Webpack, when referring to ‘dynamic imports’, this <code class="language-plaintext highlighter-rouge">import();</code> is the syntax it refers to. This would allow you to, at runtime, dynamically fetch any piece of JavaScript and use it like a module. There are some issues with this though; you cannot optimize anything that you are doing dynamically, there are some security concerns, and there is no complete browser interoperability on the syntax.</p>

<p>The two types of code splitting are static and “dynamic”. Static code splitting is useful to use whenever you have a “heavy” JavaScript library that you need to use, but you might not need it up front, anything temporal (i.e. anything that is not there at load, but can appear at some point… modal, tooltip, dialog box), routes; anytime you have routes set up (especially client-side routes), you can split the code for those routes so the user is only loading the relevant code for the route that they are on.</p>

<h3 id="code-splitting-demonstration">Code Splitting Demonstration</h3>

<p>Take a look at the following pseudo code for an example of code splitting:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">import</span> <span class="nx">Listener</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./listeners.js</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">getModal</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">import</span><span class="p">(</span><span class="dl">'</span><span class="s1">./src/modal.js</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">Listener</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">didSomethingToWarrantModalBeingLoaded</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// Async fetching modal code from a separate chunk</span>
    <span class="nx">getModal</span><span class="p">().</span><span class="nx">then</span><span class="p">((</span><span class="nx">module</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">modalTarget</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">Modal</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">module</span><span class="p">.</span><span class="nx">initModal</span><span class="p">(</span><span class="nx">modalTarget</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span></code></pre></figure>

<p>Walking through the above code, we are first importing <code class="language-plaintext highlighter-rouge">Listener</code>, then assigning a function that returns a dynamic import statement and a path to a module. Finally, when an event occurs, the above code is returning a promise that will, on promise fulfillment, perform the functionality. In the <a href="/frontend-masters/webpack-4-fundamentals">Webpack 4 Fundamentals workshop</a> [see the bottom of the page, “Q&amp;A Section”], this was shown when clicking on a button and then loading the footer code. If you are lazy… here’s the code example:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// from index.js in the workshop repo</span>
<span class="c1">//..</span>
<span class="kd">const</span> <span class="nx">loadFooter</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">import</span><span class="p">(</span><span class="dl">'</span><span class="s1">./footer</span><span class="dl">'</span><span class="p">);</span>
<span class="c1">//..</span>

<span class="nx">button</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">click</span><span class="dl">"</span><span class="p">,</span> <span class="nx">e</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">loadFooter</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">m</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">footer</span><span class="p">)</span> <span class="c1">// moved from below</span>
    <span class="p">});</span>
<span class="p">});</span></code></pre></figure>

<p>The above is code splitting. Nothing else is code splitting. If the event that triggers the asynchronous dynamic loading of JavaScript is re-triggered, it will not re-fetch the asset, but look into the cache for the code.</p>

<h3 id="webpack-code-splitting-under-the-hood">Webpack Code Splitting Under the Hood</h3>

<p><a href="https://github.com/TheLarkInn/webpack-workshop-2018/tree/feature/0500-code-splitting-example">Checkout this branch</a> and set the mode in the webpack.config.js file to none; i.e. <code class="language-plaintext highlighter-rouge">mode: "none"</code>, then run <code class="language-plaintext highlighter-rouge">npm run webpack</code>. In the <code class="language-plaintext highlighter-rouge">dist</code> folder you should see a couple of bundle files. Take a look at them to get a sense of what Webpack is doing in terms of code splitting under the hood. For my code, since I started this workshop after the Webpack  Fundamentals workshop, there are 2 bundle files in my <code class="language-plaintext highlighter-rouge">dist</code> folder; <code class="language-plaintext highlighter-rouge">1.bundle.js</code> and <code class="language-plaintext highlighter-rouge">bundle.js</code>. Webpack ‘cares’ about code coverage, so the multiple bundle files are an effort to reduce your code to only what is needed at runtime.</p>

<p>The most important piece of the bundle code is the <code class="language-plaintext highlighter-rouge">__webpack_require__e</code> function <a href="https://dev.to/jenhsuan/day-8-of-100daysofcode-the-relationship-between-bundle-chunk-and-modules-for-webpack-3hni">more details about the function here</a>.</p>

<p>The basic premise of code splitting it that Webpack creates bundles (based on your code) that handle asynchronous loading of files. And you do not have to control any of the on demand loading, it’s part of your code. All you are doing is using that function, using that dynamic import. When anyone talks about code splitting or lazy loading bundles, this is what they are talking about. Now that you have some understanding of code splitting, maybe you can take a look at a website you are working on an check out the code coverage of it and then strategize how to split up the code so that unused code is bundled differently and served only when needed! A lot of the time, the unused code is coming from another library or module.</p>

<h3 id="load-a-heavy-module-asynchronously">Load a Heavy Module Asynchronously</h3>

<p>The example here is using GSAP. Immediately, the bundle size increased dramatically and the code coverage dropped significantly. Just by importing GSAP, you are instantly not using about 80% of the library (because it is in the global scope). Lazy loading to the rescue! Just by using a dynamic import, you can immediately remove unused code from being initially loaded at runtime.</p>

<h3 id="code-splitting-in-vue-react--frameworks">Code Splitting in Vue, React, &amp; Frameworks</h3>

<p>There are some frameworks and libraries that disregarded Webpack as an important tool that people use 😢 and therefore missed the opportunity to make lazy loading a first class citizen for them. Vue (at the time of the workshop) is the only framework that has code splitting built in to it. <a href="https://reactjs.org/docs/code-splitting.html">React has some documentation about code splitting as well</a>.</p>

<h3 id="code-splitting-named-exports">Code Splitting Named Exports</h3>

<p>As of Webpack 4, code splitting named exports was not supported, there are some ideas around how they could approach it, but the example used was to import a single feature of a utility library i.e. lodash-es</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">const</span> <span class="nx">getLodashUniq</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">import</span><span class="p">(</span><span class="dl">"</span><span class="s2">lodash-es/uniq</span><span class="dl">"</span><span class="p">);</span></code></pre></figure>

<h3 id="vendor-bundles-are-an-anti-pattern">Vendor Bundles are an Anti Pattern</h3>

<p>Optimizing for caching is not the preferred method for saving load time. Pay attention to code coverage for the greatest savings at page load. Only when you get your bundle down to a very small size should you concern yourself with caching.</p>

<h3 id="dynamic-code-splitting">Dynamic Code Splitting</h3>

<p>Anytime you use an import statement i.e. <code class="language-plaintext highlighter-rouge">import('./thing.js')</code>, it’s always returning a promise and its creating and putting the modules that you dynamically imported into a separate file. “Dynamic” code splitting in Webpack is not truly dynamic. Consider the following code example:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">const</span> <span class="nx">getTheme</span> <span class="o">=</span> <span class="p">(</span><span class="nx">themeName</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">import</span><span class="p">(</span><span class="s2">`./src/themes/</span><span class="p">${</span><span class="nx">themeName</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>

<span class="c1">// Using `import()` 'dynamically'</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">feeling</span><span class="p">.</span><span class="nx">stylish</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">getTheme</span><span class="p">(</span><span class="dl">"</span><span class="s2">stylish</span><span class="dl">"</span><span class="p">).</span><span class="nx">then</span><span class="p">((</span><span class="nx">module</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">module</span><span class="p">.</span><span class="nx">applyTheme</span><span class="p">();</span>
    <span class="p">});</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">feeling</span><span class="p">.</span><span class="nx">trendy</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">getTheme</span><span class="p">(</span><span class="dl">"</span><span class="s2">trendy</span><span class="dl">"</span><span class="p">).</span><span class="nx">then</span><span class="p">((</span><span class="nx">module</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">module</span><span class="p">.</span><span class="nx">applyTheme</span><span class="p">();</span>
    <span class="p">});</span>
<span class="p">}</span></code></pre></figure>

<p>The above import statement should be familiar, assigning a variable to a function that returns a dynamic import, but in this case the path is not fully static. If you were actually using the above code, you can see that you can actually access global conditions at runtime to choose when to dynamically load something. You can use runtime conditions to choose when to load something lazily. In Webpack terms, this is considered to be a <code class="language-plaintext highlighter-rouge">Context Module</code>. The above code would tell Webpack to find all of the modules that are in the partial path <code class="language-plaintext highlighter-rouge">./src/themes/</code> and create a bundle for each of them. Ultimately, there is no real dynamic code splitting happening because all of the assets will be produced as static assets at build time, but you can dynamically serve them. Potential use cases include; A/B Testing, Theming, and Convenience.</p>

<h3 id="dynamic-code-splitting-walkthrough">Dynamic Code Splitting Walkthrough</h3>

<p>For this example, first make sure your <code class="language-plaintext highlighter-rouge">index.js</code> file looks like this:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">const</span> <span class="nx">getFooter</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">import</span><span class="p">(</span><span class="dl">"</span><span class="s2">./footer</span><span class="dl">"</span><span class="p">);</span>
<span class="k">import</span> <span class="nx">makeButton</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./button</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">makeColorStyle</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./button-styles</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="dl">"</span><span class="s2">./footer.scss</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">setButtonStyle</span> <span class="o">=</span> <span class="p">(</span><span class="nx">color</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">import</span><span class="p">(</span><span class="s2">`./button-styles/</span><span class="p">${</span><span class="nx">color</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">button</span> <span class="o">=</span> <span class="nx">makeButton</span><span class="p">(</span><span class="dl">'</span><span class="s1">I am a button</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">button</span><span class="p">.</span><span class="nx">style</span> <span class="o">=</span> <span class="nx">makeColorStyle</span><span class="p">(</span><span class="dl">"</span><span class="s2">cyan</span><span class="dl">"</span><span class="p">);</span>

<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">button</span><span class="p">);</span>

<span class="nx">button</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">click</span><span class="dl">"</span><span class="p">,</span> <span class="nx">e</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">getFooter</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">module</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">module</span><span class="p">.</span><span class="nx">footer</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">setButtonStyle</span><span class="p">(</span><span class="dl">"</span><span class="s2">red</span><span class="dl">"</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">styleStr</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">button</span><span class="p">.</span><span class="nx">style</span> <span class="o">=</span> <span class="nx">styleStr</span><span class="p">.</span><span class="k">default</span><span class="p">;</span>
    <span class="p">});</span>
<span class="p">});</span></code></pre></figure>

<p>And your <code class="language-plaintext highlighter-rouge">button.js</code> file looks like this:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">const</span> <span class="nx">makeButton</span> <span class="o">=</span> <span class="nx">buttonName</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">buttonLabel</span> <span class="o">=</span>  <span class="s2">`Button: </span><span class="p">${</span><span class="nx">buttonName</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>

  <span class="kd">const</span> <span class="nx">button</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">"</span><span class="s2">button</span><span class="dl">"</span><span class="p">);</span>
  <span class="nx">button</span><span class="p">.</span><span class="nx">innerText</span> <span class="o">=</span> <span class="nx">buttonLabel</span><span class="p">;</span>

  <span class="k">return</span> <span class="nx">button</span><span class="p">;</span>
<span class="p">};</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">makeButton</span><span class="p">;</span></code></pre></figure>

<p>Once your files match the above, make a new folder in your <code class="language-plaintext highlighter-rouge">src</code> directory named <code class="language-plaintext highlighter-rouge">button-styles</code>. In the <code class="language-plaintext highlighter-rouge">button-styles</code> folder add <code class="language-plaintext highlighter-rouge">red.js blue.js green.js yellow.js</code> files. Each of those files should look like this:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">export</span> <span class="k">default</span> <span class="dl">"</span><span class="s2">color: colorFromFileName;</span><span class="dl">"</span> <span class="c1">// i.e. blue.js would be "color: blue;"</span></code></pre></figure>

<p>If you now run <code class="language-plaintext highlighter-rouge">npm run dev</code>, you should find new bundle files, 1 for each file in the <code class="language-plaintext highlighter-rouge">button-styles</code> folder, output in the <code class="language-plaintext highlighter-rouge">dist</code> folder. Following the button example, try to think of some other examples where you might want to structure your components so that the code for them is only downloaded when needed, perhaps based on an event trigger? If you had additional files in the <code class="language-plaintext highlighter-rouge">button-styles</code> folder, that maybe you did not want to include, you can specify in the <code class="language-plaintext highlighter-rouge">index.js</code> file (or wherever you have defined the import) that you only want that specific file type by adding the extension i.e. <code class="language-plaintext highlighter-rouge">...import(</code>./button-styles/${color}.js<code class="language-plaintext highlighter-rouge">)</code>.</p>

<h2 id="module-methods--magic-comments">Module Methods &amp; Magic Comments</h2>

<h3 id="introducing-magic-comments">Introducing Magic Comments</h3>

<p>When you are using code splitting as a technique, there is no name that is created when you add the bundle. This is because it is not an entry-point so it cannot be given an assigned name. When you look at the <code class="language-plaintext highlighter-rouge">dist</code> folder after a build, you will find a number of bundles there, but they are not named in a way that is immediately understandable. Enter <a href="https://webpack.js.org/api/module-methods/#magic-comments">Magic Comments</a>! One of the things that Magic Comments allow you to do is name your bundles. This could prove valuable when you are debugging or if you are trying to keep track of which files generate their own bundles. In <code class="language-plaintext highlighter-rouge">index.js</code> add a <code class="language-plaintext highlighter-rouge">webpackChunkName</code> to the footer import:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">const</span> <span class="nx">getFooter</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">import</span><span class="p">(</span><span class="cm">/* webpackChunkName: "footer" */</span><span class="dl">"</span><span class="s2">./footer</span><span class="dl">"</span><span class="p">);</span></code></pre></figure>

<p>To get the name to appear as part of the bundle name, update the <code class="language-plaintext highlighter-rouge">webpack.config.js</code> file like so:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">//...</span>

<span class="nx">output</span><span class="p">:</span> <span class="p">{</span>
        <span class="nl">filename</span><span class="p">:</span> <span class="dl">"</span><span class="s2">bundle.js</span><span class="dl">"</span><span class="p">,</span>
        <span class="nx">chunkFilename</span><span class="p">:</span> <span class="dl">"</span><span class="s2">[name].lazy-chunk.js</span><span class="dl">"</span> <span class="c1">// you can just use [name], the instructor prefers to add the .lazy-chunk</span>
    <span class="p">},</span>

<span class="c1">//...</span></code></pre></figure>

<p>This may be useful to include as part of a base configuration, depending on your requirements maybe only the dev configuration?</p>

<h3 id="webpack-modes">Webpack Modes</h3>

<p>Also a part of Magic Comments is a feature called <code class="language-plaintext highlighter-rouge">webpackMode</code>. With this you can further control how code splitting happens, with four different settings. In the instance of the button styles, <code class="language-plaintext highlighter-rouge">/* webpaackMode: "lazy-once" */</code> would generate a single bundle, which can save build time. Pushing this further and continuing to define different build configurations, you could add this to the <code class="language-plaintext highlighter-rouge">index.js</code> file:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">if</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">development</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">setButtonStyle</span> <span class="o">=</span> <span class="p">(</span><span class="nx">color</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">import</span><span class="p">(</span><span class="cm">/* webpackMode: "lazy-once" */</span> <span class="s2">`./button-styles/</span><span class="p">${</span><span class="nx">color</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">setButtonStyle</span> <span class="o">=</span> <span class="p">(</span><span class="nx">color</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">import</span><span class="p">(</span><span class="s2">`./button-styles/</span><span class="p">${</span><span class="nx">color</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<p>Webpack, by default, injects a macro replacement to the <code class="language-plaintext highlighter-rouge">process.ev.NODE_ENV</code> variable. When you set the mode to <code class="language-plaintext highlighter-rouge">development</code>, the macro converts to development and by default, Webpack can convert the above code and evaluate the if/else statement. You probably care less about performance optimizations in your dev code, but while in dev would like faster build times, this is useful for that.</p>

<h3 id="webpack-prefetch--preload">Webpack Prefetch &amp; Preload</h3>

<p><em>Insert shameless plug to subscribe to the Webpack Medium account and <a href="https://medium.com/webpack/link-rel-prefetch-preload-in-webpack-51a52358f84c">this article</a></em></p>

<p>One of the trade-offs when code splitting is either having a smaller initial download or having additional network requests, both have their performance trade-offs. Two additional Webpack Magic Comments are <code class="language-plaintext highlighter-rouge">/* webpackPrefetch /*</code> and <code class="language-plaintext highlighter-rouge">/* webpackPreload /*</code> both of which use <code class="language-plaintext highlighter-rouge">&lt;link rel"pre[fetch/load]"&gt;</code> respectively. <a href="https://webpack.js.org/guides/code-splitting/#prefetchingpreloading-modules">More info about prefetch and preload in the Webpack documentation</a> Similar to the previous Magic Comments, try adding a <code class="language-plaintext highlighter-rouge">/* webpackPrefetch /*</code> or <code class="language-plaintext highlighter-rouge">/* webpackPreload /*</code> to one of the ‘lazy loaded’ bundles. Run <code class="language-plaintext highlighter-rouge">npm run dev</code> again and when you look at the source code on your dev server, you should see a <code class="language-plaintext highlighter-rouge">&lt;link&gt;</code> with <code class="language-plaintext highlighter-rouge">rel="preload"</code> or <code class="language-plaintext highlighter-rouge">rel="prefetch"</code> depending on which one you chose.</p>

<h3 id="wrapping-up-code-splitting">Wrapping Up Code Splitting</h3>

<p>As a topic for this workshop, code splitting has been exhausted. Nothing more to see here. But… Code splitting literally exists to solve the issue of load time as it relates to how much JavaScript you ship with the initial experience.</p>

<h3 id="webpack-config-organization">Webpack Config Organization</h3>

<p>The Webpack config organization has already been discussed / built in the <a href="/frontend-masters/webpack-4-fundamentals">Webpack 4 Fundamentals workshop</a>, with something like:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="o">-</span> <span class="nx">build</span><span class="o">-</span><span class="nx">utils</span>
    <span class="o">-</span> <span class="nx">presets</span>
        <span class="nx">webpack</span><span class="p">.</span><span class="nx">analyze</span><span class="p">.</span><span class="nx">js</span>
        <span class="nx">webpack</span><span class="p">.</span><span class="nx">compress</span><span class="p">.</span><span class="nx">js</span>
    <span class="nx">loadPresets</span><span class="p">.</span><span class="nx">js</span>
    <span class="nx">webpack</span><span class="p">.</span><span class="nx">development</span><span class="p">.</span><span class="nx">js</span>
    <span class="nx">webpack</span><span class="p">.</span><span class="nx">production</span><span class="p">.</span><span class="nx">js</span>
<span class="o">-</span> <span class="nx">dist</span>
<span class="o">-</span> <span class="nx">node_modules</span>
<span class="o">-</span> <span class="nx">src</span>
<span class="p">.</span><span class="nx">gitignore</span>
<span class="nx">LICENSE</span>
<span class="kr">package</span><span class="p">.</span><span class="nx">json</span>
<span class="nx">README</span><span class="p">.</span><span class="nx">md</span>
<span class="nx">TODO</span><span class="p">.</span><span class="nx">md</span>
<span class="nx">webpack</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">js</span></code></pre></figure>

<p>The idea with presets is not that you only test out a single piece of functionality, like analyze or compress, but that you can build out entire sets of isolated functionality that allows you to experiment, test, or any other reason that you can just add on with a flag or add on with an extra script. The above configuration is enough to get started with the most complex piece of it being the <code class="language-plaintext highlighter-rouge">loadPresets.js</code> file, which is basically just flattening presets and making sure that if there is not a preset that it doesn’t fail. Best practice is, don’t hide your Webpack config, keep it at the root level of your project.</p>

<h3 id="building-your-library-with-webpack">Building Your Library with Webpack</h3>

<p>Q: Should you build your library with Webpack?</p>

<p>A: The only time you should consider it is if you were going to ship something that could be loaded with a script tag, like a UMD (Universal Module Definition) bundle. If you yourself are using Webpack don’t use anything else that has been built with Webpack. You lose out on being able to tree shake, scope hoist, or any of the other optimizations.</p>

</div>
    </main><footer class="usa-footer usa-footer-medium" role="contentinfo"><div class="usa-grid usa-footer-return-to-top">
      <a href="#">Return to top</a>
    </div><div class="usa-footer-secondary_section">
    <div class="usa-grid">
      <div class="usa-footer-logo"><img class="usa-footer-logo-img" src="/assets/img/hztl-wm.svg" alt="HZTL-WM"><p>William has consumed <span class="la-croix"></span> cans of <a href="/la-croix"><span class="la-croix-logo"></span></a> since Sept. 3rd, 2019.<br/><em class="lighten-up"> * cans of delicious, bubbly, essenced water consumed accurate by ±50%</em></p></div><div class="usa-footer-contact-links usa-width-one-half"></div>
    </div>
  </div></footer><script src="/assets/uswds/js/uswds.min.js"async></script><script src="/assets/js/la-croix.js"></script><script src="/assets/js/scroll-watch.js"></script></body>
</html>
